stages:
  - test

services:
  - manticoresearch/manticore

before_script:
  - curl -X POST http://manticoresearch-manticore:9308/sql -d "mode=raw&query=CREATE TABLE test(content text, name text attribute, cat integer)"
  - curl -X POST http://manticoresearch-manticore:9308/sql -d "mode=raw&query=CREATE TABLE test_pq(content text, name text attribute, cat integer) type='pq'"  

python_testing:
  image: python
  stage: test
  only:
    changes:
      - out/manticore-python/**/*
  script:
    - cd out/manticore-python
    - pip install -r requirements.txt
    - python setup.py install
    - python test/test.py

javascript_testing:
  image: node
  stage: test
  only:
    changes:
      - out/manticore-javascript/**/*
  script:
    - cd out/manticore-javascript
    - npm install --only=dev
    - npm test